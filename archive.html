<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Archive - TechPulse</title>
    <meta name="description" content="Browse all articles from TechPulse, your source for tech insights and innovation stories.">
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Navigation -->
    <nav class="nav">
        <div class="container">
            <div class="nav-content">
                <a href="index.html" class="logo">TECHPULSE</a>
                
                <!-- Search Bar -->
                <div class="search-container">
                    <div class="search-input-wrapper">
                        <svg class="search-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"></circle>
                            <path d="m21 21-4.35-4.35"></path>
                        </svg>
                        <input type="text" 
                               id="mainSearchInput" 
                               class="search-input" 
                               placeholder="Search articles... (press / to focus)"
                               autocomplete="off">
                        <kbd class="search-kbd">/</kbd>
                    </div>
                </div>
                
                <div class="nav-links">
                    <a href="index.html#latest">Latest</a>
                    <a href="archive.html">Archive</a>
                    <a href="index.html#categories">Topics</a>
                    <a href="index.html#newsletter">Newsletter</a>
                    <a href="about.html">About</a>
                </div>
                <div style="display: flex; align-items: center; gap: var(--spacing-md);">
                    <div class="theme-toggle">
                        <button data-theme-option="light" title="Light mode">‚òÄÔ∏è</button>
                        <button data-theme-option="auto" title="System" class="active">Auto</button>
                        <button data-theme-option="dark" title="Dark mode">üåô</button>
                    </div>
                    <button class="mobile-menu-btn" id="mobileMenuBtn">
                        <span></span>
                        <span></span>
                        <span></span>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Page Header -->
    <section class="hero hero-blog" style="min-height: 40vh;">
        <div class="container">
            <div class="hero-content">
                <h1 class="hero-title" style="font-size: 3.5rem;">Archive</h1>
                <p class="hero-subtitle">
                    Every story, insight, and analysis we've published. Dive into the complete collection.
                </p>
            </div>
        </div>
    </section>

    <!-- Filter Options -->
    <section class="section" style="padding-top: var(--spacing-md);">
        <div class="container">
            <div id="category-filters" style="display: flex; gap: var(--spacing-sm); flex-wrap: wrap; justify-content: center; margin-bottom: var(--spacing-lg);">
                <!-- Dynamically populated from categories -->
            </div>
        </div>
    </section>

    <!-- Articles Archive -->
    <section class="section">
        <div class="container">
            <div id="loading-archive" style="text-align: center; padding: var(--spacing-xl);">
                <p>Loading archive...</p>
            </div>
            <div id="archive-content" style="display: none;">
                <!-- Articles dynamically loaded by date -->
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-brand">
                    <h3>TECHPULSE</h3>
                    <p>Daily insights on technology, startups, and innovation. Curated for curious minds.</p>
                </div>
                <div class="footer-links">
                    <div class="footer-column">
                        <h4>Explore</h4>
                        <a href="archive.html">Archive</a>
                        <a href="index.html#categories">Topics</a>
                        <a href="export_ratings.html">Export Ratings</a>
                    </div>
                    <div class="footer-column">
                        <h4>About</h4>
                        <a href="about.html">About Us</a>
                        <a href="privacy.html">Privacy Policy</a>
                        <a href="terms.html">Terms of Service</a>
                    </div>
                    <div class="footer-column">
                        <h4>Resources</h4>
                        <a href="LEARNING-SYSTEM.md" target="_blank">Learning System</a>
                        <a href="https://github.com" target="_blank">GitHub</a>
                        <a href="mailto:hello@techpulse.blog">Contact</a>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 TechPulse. Built with privacy in mind. <a href="privacy.html">Privacy</a> ‚Ä¢ <a href="terms.html">Terms</a></p>
            </div>
        </div>
    </footer>

    <script src="script.js"></script>
    <script src="js/search-engine.js"></script>
    <script src="js/search-ui.js"></script>
    <script>
        // Archive Page Loader
        const ArchiveLoader = {
            allArticles: [],
            allCategories: new Set(),
            currentFilter: 'all',
            
            async init() {
                try {
                    await this.loadAllDailyFiles();
                    this.extractCategories();
                    this.renderFilters();
                    this.renderArticles();
                    
                    document.getElementById('loading-archive').style.display = 'none';
                    document.getElementById('archive-content').style.display = 'block';
                } catch (error) {
                    console.error('Error loading archive:', error);
                    document.getElementById('loading-archive').innerHTML = '<p>Error loading archive. Please try again later.</p>';
                }
            },
            
            async loadAllDailyFiles() {
                // Get list of daily JSON files by trying to load them
                // We'll try the last 60 days
                const today = new Date();
                const promises = [];
                
                for (let i = 0; i < 60; i++) {
                    const date = new Date(today);
                    date.setDate(date.getDate() - i);
                    const dateStr = date.toISOString().split('T')[0];
                    
                    // Try base file and suffixed versions (_2, _3)
                    for (let suffix of ['', '_2', '_3', '_4', '_5']) {
                        const filename = `content/daily/${dateStr}${suffix}.json`;
                        promises.push(
                            fetch(filename)
                                .then(res => res.ok ? res.json() : null)
                                .catch(() => null)
                        );
                    }
                }
                
                const results = await Promise.all(promises);
                const dailyFiles = results.filter(data => data !== null);
                
                // Collect all articles
                dailyFiles.forEach(dailyData => {
                    if (dailyData.articles) {
                        dailyData.articles.forEach(article => {
                            this.allArticles.push({
                                ...article,
                                date_display: dailyData.date_display,
                                date: dailyData.date
                            });
                        });
                    }
                });
                
                // Sort by date descending (newest first)
                this.allArticles.sort((a, b) => new Date(b.published) - new Date(a.published));
                
                console.log(`‚úì Loaded ${this.allArticles.length} articles from ${dailyFiles.length} daily files`);
            },
            
            extractCategories() {
                this.allArticles.forEach(article => {
                    if (article.category) {
                        this.allCategories.add(article.category);
                    }
                });
            },
            
            renderFilters() {
                const filterContainer = document.getElementById('category-filters');
                
                // Add "All" button
                const allBtn = document.createElement('button');
                allBtn.className = 'btn-primary';
                allBtn.style.padding = '10px 20px';
                allBtn.textContent = 'All';
                allBtn.onclick = () => this.filterByCategory('all');
                filterContainer.appendChild(allBtn);
                
                // Add category buttons
                const sortedCategories = Array.from(this.allCategories).sort();
                sortedCategories.forEach(category => {
                    const btn = document.createElement('button');
                    btn.className = 'btn-secondary';
                    btn.style.padding = '10px 20px';
                    btn.textContent = this.shortenCategoryName(category);
                    btn.onclick = () => this.filterByCategory(category);
                    btn.dataset.category = category;
                    filterContainer.appendChild(btn);
                });
            },
            
            shortenCategoryName(category) {
                // Shorten long category names for buttons
                const mapping = {
                    'Enterprise AI Adoption for SaaS': 'Enterprise AI',
                    'Building AI Division & Center of Excellence': 'AI CoE',
                    'Enterprise AI Strategy & Roadmap': 'AI Strategy',
                    'New Model Releases & Evals': 'Model Releases',
                    'AI Privacy & Surveillance': 'Privacy',
                    'Enterprise Ai Adoption For Saas': 'Enterprise AI',
                    'Building Ai Division & Center Of Excellence': 'AI CoE',
                    'Enterprise Ai Strategy & Roadmap': 'AI Strategy'
                };
                return mapping[category] || category;
            },
            
            filterByCategory(category) {
                this.currentFilter = category;
                
                // Update button states
                document.querySelectorAll('#category-filters button').forEach(btn => {
                    if (category === 'all' && btn.textContent === 'All') {
                        btn.className = 'btn-primary';
                    } else if (btn.dataset.category === category) {
                        btn.className = 'btn-primary';
                    } else {
                        btn.className = 'btn-secondary';
                    }
                });
                
                this.renderArticles();
            },
            
            renderArticles() {
                const container = document.getElementById('archive-content');
                container.innerHTML = '';
                
                // Filter articles
                const filteredArticles = this.currentFilter === 'all' 
                    ? this.allArticles 
                    : this.allArticles.filter(a => a.category === this.currentFilter);
                
                if (filteredArticles.length === 0) {
                    container.innerHTML = '<p style="text-align: center; padding: var(--spacing-xl);">No articles found for this category.</p>';
                    return;
                }
                
                // Group by date
                const grouped = {};
                filteredArticles.forEach(article => {
                    if (!grouped[article.date_display]) {
                        grouped[article.date_display] = [];
                    }
                    grouped[article.date_display].push(article);
                });
                
                // Render each date group
                Object.keys(grouped).sort((a, b) => {
                    // Sort by actual date, not display string
                    const dateA = grouped[a][0].date;
                    const dateB = grouped[b][0].date;
                    return dateB.localeCompare(dateA);
                }).forEach(dateDisplay => {
                    const articles = grouped[dateDisplay];
                    
                    const dateSection = document.createElement('div');
                    dateSection.style.marginBottom = 'var(--spacing-xl)';
                    
                    const dateHeader = document.createElement('h2');
                    dateHeader.style.fontSize = '1.5rem';
                    dateHeader.style.marginBottom = 'var(--spacing-md)';
                    dateHeader.style.color = 'var(--color-text-light)';
                    dateHeader.textContent = dateDisplay;
                    dateSection.appendChild(dateHeader);
                    
                    const grid = document.createElement('div');
                    grid.className = 'articles-grid';
                    
                    articles.forEach((article, index) => {
                        grid.appendChild(this.createArticleCard(article, index));
                    });
                    
                    dateSection.appendChild(grid);
                    container.appendChild(dateSection);
                });
                
                console.log(`‚úì Rendered ${filteredArticles.length} articles`);
            },
            
            createArticleCard(article, index) {
                const card = document.createElement('article');
                card.className = 'article-card';
                
                const colors = [
                    '#667eea 0%, #764ba2 100%',
                    '#4F46E5 0%, #06B6D4 100%',
                    '#0EA5E9 0%, #14B8A6 100%',
                    '#3B82F6 0%, #8B5CF6 100%',
                    '#6366F1 0%, #06B6D4 100%',
                    '#0EA5E9 0%, #2563EB 100%'
                ];
                const gradient = colors[index % colors.length];
                
                const publishedDate = new Date(article.published);
                const timeAgo = ContentLoader.getTimeAgo(article.published);
                const readTime = this.estimateReadTime(article.word_count);
                
                // Get source URL
                const sourceUrl = ContentLoader.getSourceUrl(article.source);
                
                card.innerHTML = `
                    <div class="article-image">
                        ${article.image_url 
                            ? `<img src="${article.image_url}" alt="${article.title}" onerror="this.parentElement.innerHTML='<div class=\\'image-placeholder\\' style=\\'background: linear-gradient(135deg, ${gradient});\\' ><span>${article.category}</span></div>';">`
                            : `<div class="image-placeholder" style="background: linear-gradient(135deg, ${gradient});"><span>${article.category}</span></div>`
                        }
                    </div>
                    <div class="article-content">
                        <div class="article-meta">
                            <span class="category">${article.category}</span>
                            <span class="time">${timeAgo}</span>
                        </div>
                        <h3 class="article-title">
                            <a href="${article.url}" target="_blank">${article.title}</a>
                        </h3>
                        <div class="article-footer">
                            <span class="author-small">
                                <a href="${sourceUrl}" target="_blank" style="color: inherit; text-decoration: none;">${article.source}</a>
                            </span>
                            <span class="read-time-small">${readTime} ‚Ä¢ Score: ${article.score}</span>
                        </div>
                    </div>
                `;
                
                return card;
            },
            
            estimateReadTime(wordCount) {
                if (!wordCount) return '1 min';
                const minutes = Math.ceil(wordCount / 200);
                return `${minutes} min`;
            }
        };
        
        // Initialize when page loads
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => ArchiveLoader.init());
        } else {
            ArchiveLoader.init();
        }
    </script>
</body>
</html>
